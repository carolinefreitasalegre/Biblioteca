@inject ILivroService service

<RadzenCard class="rz-p-4 rz-shadow-2" Style="min-height: 16em">
    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem" class="rz-mb-4">
        <RadzenIcon Icon="trending_up" Style="color: #6a1b9a;" /> 
        <RadzenText TextStyle="TextStyle.H5" Style="color: #6a1b9a; font-weight: bold;">
            Suas EstatÃ­sticas
        </RadzenText>
    </RadzenStack>

    <div class="d-flex justify-content-between rz-mb-3">
        <RadzenText TextStyle="TextStyle.Body1">Livros lidos este mÃªs</RadzenText>
        <RadzenText TextStyle="TextStyle.H5" Style="color: green; font-weight: bold;">
            @LivrosConcluidosMes
        </RadzenText>
    </div>

    <div class="d-flex justify-content-between rz-mb-4">
        <RadzenText TextStyle="TextStyle.Body1">PÃ¡ginas lidas</RadzenText>
        <RadzenText TextStyle="TextStyle.H5" Style="color: #0000a0; font-weight: bold;">
            @PaginasLidas
        </RadzenText>
    </div>

    <div class="rz-mt-2">
        <RadzenText TextStyle="TextStyle.Body1" Style="font-weight: bold;">
            ðŸ“Š Resumo do mÃªs
        </RadzenText>
        <RadzenText TextStyle="TextStyle.Body2" Class="rz-text-secondary">
            @ResumoDoMes
        </RadzenText>
    </div>
</RadzenCard>

@code {
    private int LivrosIniciadosMes;
    private int LivrosConcluidosMes;
    private int PaginasLidas;

    protected override async Task OnInitializedAsync()
    {
        var livros = await service.ListarLivros();

        var hoje = DateTime.Today;
        var inicioMesAtual = new DateTime(hoje.Year, hoje.Month, 1);

        var livrosDoMes = livros
            .Where(l => l.DataAdicionado >= inicioMesAtual)
            .ToList();

        LivrosIniciadosMes = livrosDoMes
            .Count(l => l.StatusLeitura == EStatusLeitura.Lendo);

        LivrosConcluidosMes = livrosDoMes
            .Count(l => l.StatusLeitura == EStatusLeitura.Lido);

        PaginasLidas = livrosDoMes
            .Where(l => l.StatusLeitura == EStatusLeitura.Lido)
            .Sum(l => l.NumeroPaginas);
    }

    private string ResumoDoMes =>
        LivrosIniciadosMes == 0 && LivrosConcluidosMes == 0
            ? "Ainda nÃ£o houve atividades de leitura neste mÃªs."
            : $"VocÃª iniciou {LivrosIniciadosMes} livro(s) e concluiu {LivrosConcluidosMes} neste mÃªs.";
}
