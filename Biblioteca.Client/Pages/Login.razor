@page "/"
@layout EmptyLayout
@inject IAuthService AuthService 
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage
@inject NavigationManager NavManager
@inject Microsoft.AspNetCore.Components.Authorization.AuthenticationStateProvider AuthStateProvider 


<RadzenRow Gap="0"
           class="rz-my-12 rz-mx-auto rz-border-radius-6 rz-shadow-10"
           Style="width: 100%; max-width: 800px; overflow: hidden;">

    <!-- üîµ LADO ESQUERDO / BRANDING -->
    <RadzenColumn Size="12" SizeMD="6">
        <RadzenCard class="rz-shadow-0 rz-border-radius-0 rz-p-12"
                    Style="height: 100%;">

            <RadzenStack AlignItems="AlignItems.Center"
                         JustifyContent="JustifyContent.Center"
                         Gap="1rem"
                         Style="height: 100%; text-align: center;">

                <RadzenImage Path="/logo.png"
                             Style="width: 12rem;"
                             AlternateText="Logo Biblioteca" />

                <RadzenText TextStyle="TextStyle.DisplayH5"
                            Style="color: var(--primary);">
                    Bem-vindo!
                </RadzenText>

                <RadzenText TextStyle="TextStyle.Body1"
                            Style="color: var(--primary); max-width: 260px;">
                    Gerencie sua biblioteca de forma simples e inteligente.
                </RadzenText>

                <RadzenText TextStyle="TextStyle.Body2"
                            Style="color: var(--primary);">
                    Comece agora gratuitamente!
                </RadzenText>

            </RadzenStack>
        </RadzenCard>
    </RadzenColumn>

    <!-- üü£ LADO DIREITO / LOGIN -->
    <RadzenColumn Size="12" SizeMD="6">
        <RadzenCard class="rz-shadow-0 rz-border-radius-0 rz-p-12"
                    Style="height: 100%;">

            <RadzenStack Gap="1.5rem"
                         JustifyContent="JustifyContent.Center"
                         Style="height: 100%;">

                <RadzenText TextStyle="TextStyle.H5"
                            Style="color: var(--btn);">
                    Login
                </RadzenText>

                <RadzenTemplateForm Data="@loginModel">
                    <RadzenLogin AllowRegister="false"
                                 AllowResetPassword="false"
                                 Login="@OnLogin"
                                 Style="--rz-primary: var(--btn);" />
                </RadzenTemplateForm>

                <RadzenStack Gap="0.75rem"
                             class="rz-mt-8"
                             AlignItems="AlignItems.Center">

                    <RadzenLink Text="Esqueci minha senha"
                                Path="/esqueci-senha"
                                Style="font-size: 0.85rem; color: var(--primary);" />

                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.25rem">
                        <RadzenText TextStyle="TextStyle.Body2">    
                            Ainda n√£o tem conta?
                        </RadzenText>

                        <RadzenLink Text="Criar conta"
                                    Path="/criar-conta"
                                    Style="font-weight: 600;" />
                    </RadzenStack>

                </RadzenStack>

            </RadzenStack>
        </RadzenCard>
    </RadzenColumn>

</RadzenRow>


@code {
    
    private LoginDto loginModel = new LoginDto(); 

    private async Task OnLogin(LoginArgs args) 
    {

        var loginDto = new LoginDto { 
            Email = args.Username, 
            Senha = args.Password
        };
        
        var loginResponse = await AuthService.Login(loginDto);
        
        
        
        if (loginResponse != null && !string.IsNullOrEmpty(loginResponse.Token))
        {
            var customProvider = (CustomAuthenticationStateProvider)AuthStateProvider;
            
            customProvider.NotifyUserLoggedIn(loginResponse.Token);

            NavManager.NavigateTo("/home", forceLoad: true);
        }
        else
        {
        
            Console.WriteLine("erro");
        }
        
        
    }

  

   
}
